{% extends "index.html" %}

{% block content %}

<head>
  <title>PopcornU!</title>
  <link hrel="http://fonts.googleapis.com/css?family=Roboto:300,500" rel="stylesheet">
<!--   <link rel="stylesheet" href="style.css"> -->
</head>


<body>
<!-- <h1 id="bigOne"></h1> -->

<div class="container">
  <h1>Login</h1>
  <input id="txtEmail" type="email" placeholder="Email">
  <input id="txtPassword" type="password" placeholder="Password">
  <button id="btnLogin" class="btn btn-action">Login</button>
  <button id="btnSignUp" class="btn btn-secondary">Register</button>
  <button id="btnLogout" class="btn btn-action hide">Log out</button>
  <hr>
  <div id="user-info"><h3 id="login-info"></h3></div>
</div>

{% endblock %}


{% block scripts %}
 <script src="https://www.gstatic.com/firebasejs/4.13.0/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyD2rfrga7gEv9s9nK3HBH13rH3BvJzbDHU",
    authDomain: "popcornu-user.firebaseapp.com",
    databaseURL: "https://popcornu-user.firebaseio.com",
    projectId: "popcornu-user",
    storageBucket: "popcornu-user.appspot.com",
    messagingSenderId: "249396109468"
  };
  firebase.initializeApp(config);

  var bigOne = document.getElementById('bigOne');
  var dbRef = firebase.database().ref().child('Text');
  dbRef.on('value', snap => bigOne.innerText = snap.val())



   //test database
  // var bigOne = document.getElementById('bigOne');
  // var dbRef = firebase.database().ref().child('Text');
  // dbRef.on('value', snap => bigOne.innerText = snap.val())

  //create elements
  const txtEmail = document.getElementById('txtEmail');
  const txtPassword = document.getElementById('txtPassword');
  const btnLogin = document.getElementById('btnLogin');
  const btnSignUp = document.getElementById('btnSignUp');
  const btnLogout = document.getElementById('btnLogout'); 

  //login event
  btnLogin.addEventListener('click', e=> {
      const email = txtEmail.value;
      const password = txtPassword.value;
      const auth = firebase.auth();
      const promise = auth.signInWithEmailAndPassword(email,password);
      promise.catch(e => {
      console.log(e.message);
      alert(e.message);
    });
  }); 

  //signup event
  btnSignUp.addEventListener('click', e => {
      const email = txtEmail.value;
      const password = txtPassword.value;
      const auth = firebase.auth();
      const promise = auth.createUserWithEmailAndPassword(email,password);
      promise.catch(e => {
      console.log(e.message);
      alert(e.message);
    });
     
  });

  //logout event
  btnLogout.addEventListener('click', e => {
      firebase.auth().signOut();
  });

  //realtime listener
  firebase.auth().onAuthStateChanged(firebaseUser => {
    if(firebaseUser){
      console.log(firebaseUser);
      btnLogout.classList.remove('hide');
      btnSignUp.classList.add('hide');
      btnLogin.classList.add('hide');
      document.getElementById("login-info").innerHTML = firebaseUser.email + ' has signed in.';
    } else {
      console.log('No user logged in');
      btnLogout.classList.add('hide');
      btnSignUp.classList.remove('hide');
      btnLogin.classList.remove('hide');
      document.getElementById("login-info").innerHTML = 'No user logged in.';
    }
  });

 //  firebase.auth().onAuthStateChanged(function(user) {
 //  if (user) {
 //    console.log(user.email + ' is signed in.');
 //    document.getElementById("login-info").innerHTML = user.email + ' has signed in.';

 //  } else {
 //    console.log('No user signed in.');
 //    document.getElementById("login-info").innerHTML = 'No user signed in.';

 //  }
 // });

</script>
{% endblock %}